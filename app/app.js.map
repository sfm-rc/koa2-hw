{"version":3,"sources":["../src/app.js"],"names":[],"mappings":"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","file":"app.js","sourcesContent":["import http from 'http'\r\nimport Koa from 'koa'\r\nimport path from 'path'\r\nimport convert from 'koa-convert'\r\nimport json from 'koa-json'\r\nimport Bodyparser from 'koa-bodyparser'\r\nimport logger from 'koa-logger'\r\nimport koaStatic from 'koa-static-plus'\r\nimport config from './config'\r\nimport cors from 'koa2-cors'\r\nimport send from 'koa-send'\r\n\r\nconst app = new Koa()\r\nconst bodyparser = Bodyparser()\r\n\r\n// middlewares\r\napp.use(cors({\r\n  origin: function(ctx) {\r\n    if (ctx.url === '/test') {\r\n      return false;\r\n    }\r\n    return '*';\r\n  },\r\n  // exposeHeaders: ['WWW-Authenticate', 'Server-Authorization'],\r\n  maxAge: 60*60*24*7,\r\n  credentials: true,\r\n  // allowMethods: ['GET', 'POST', 'DELETE'],\r\n  // allowHeaders: ['Content-Type', 'Authorization', 'Accept'],\r\n}))\r\napp.use(convert(bodyparser))\r\napp.use(convert(json()))\r\napp.use(convert(logger()))\r\n\r\n// static\r\napp.use(convert(koaStatic(path.join(__dirname, '../public'), {\r\n  pathPrefix: ''\r\n})))\r\n\r\n// views\r\n// app.use(views(path.join(__dirname, '../views'), {\r\n//   extension: 'ejs'\r\n// }))\r\n\r\n// 500 error\r\n// koaOnError(app, {\r\n//   template: 'views/500.ejs'\r\n// })\r\n\r\n// logger\r\napp.use(async (ctx, next) => {\r\n  const start = new Date()\r\n  await next()\r\n  const ms = new Date() - start\r\n  console.log(`${ctx.method} ${ctx.url} - ${ms}ms`)\r\n})\r\napp.use(async (ctx, next) => {\r\n  //console.log('--------ctx:', ctx);\r\n  const url = ctx.url;\r\n  if (url.indexOf('/dist') > -1) {\r\n    const filePath = url.substr(url.lastIndexOf('/'), url.length);\r\n    console.log('---------filePath:', filePath);\r\n    await send(ctx, path.resolve('/public/dist' + filePath));\r\n  } else {\r\n    await send(ctx, path.resolve('/public/index.html'));\r\n  }\r\n  await next();\r\n});\r\n\r\n//app.use(serve('/public'));\r\napp.use(async (ctx, next) => {\r\n  const url = ctx.url;\r\n  console.log('--------url:', url);\r\n  if (url.indexOf('user-hw-static') > -1) {\r\n    const filePath = url.substr(url.lastIndexOf('/'), url.length);\r\n    console.log('---------filePath:', filePath);\r\n    await send(ctx, path.resolve('/public/dist' + filePath));\r\n  } \r\n  else {\r\n    await send(ctx, path.resolve('/public/dist/index.html'));\r\n  }\r\n  await next();\r\n});\r\n\r\n// response router\r\napp.use(async (ctx, next) => {\r\n  console.log('----api');\r\n  await require('./routes').routes()(ctx, next)\r\n})\r\n// const routers = require('./routes')\r\n// app.use('/hw', routers.routes()).use(routers.allowedMethods())\r\n\r\n// 404\r\n// app.use(async (ctx) => {\r\n//   ctx.status = 404\r\n//   await ctx.render('404')\r\n// })\r\n\r\n// error logger\r\napp.on('error', async (err, ctx) => {\r\n  console.log('error occured:', err)\r\n})\r\n\r\nconst port = parseInt(config.port || '3000')\r\nconst server = http.createServer(app.callback())\r\n\r\nserver.listen(port)\r\nserver.on('error', (error) => {\r\n  if (error.syscall !== 'listen') {\r\n    throw error\r\n  }\r\n  // handle specific listen errors with friendly messages\r\n  switch (error.code) {\r\n    case 'EACCES':\r\n      console.error(port + ' requires elevated privileges')\r\n      process.exit(1)\r\n      break\r\n    case 'EADDRINUSE':\r\n      console.error(port + ' is already in use')\r\n      process.exit(1)\r\n      break\r\n    default:\r\n      throw error\r\n  }\r\n})\r\nserver.on('listening', () => {\r\n  console.log('Listening on port: %d', port)\r\n})\r\n\r\nexport default app\r\n"]}